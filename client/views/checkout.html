{{include 'global/header'}}

{{set 'user' session.user}}

    <div class="site-section">
      <div class="container">
        <form method="POST"   onsubmit="return placeOrder(this)"  autocomplete="off">
        <div class="row mt-3 mb-5">
          <div class="col-md-12">
              {{#if (not user.isLogged)}}
            <div class="border p-4 rounded" role="alert">
              Returning customer? <a href="{{app.url}}account" >Click here</a> to login
            </div>
            {{/if}}
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-5 mb-md-0">
            <h2 class="h3 mb-3 text-black">Shipping Details</h2>
         
            <div class="p-3 p-lg-5 border">

                {{#if user.user_address }}

                {{set address  user.user_address }}
                <div class="checkout-added-address-box">
                <h3>Ship to:</h3>
                <p>
                  {{address.ship_first_name}} {{address.ship_last_name}},  {{address.ship_address}} {{address.ship_address_more}}
                  {{address.ship_state_country}}, Pin - {{address.ship_zip}}
                  &nbsp; &nbsp;
                  <a style="cursor: pointer"  onclick="checkoutAddShowEdit();"> Edit </a>
                </p>
                
              </div>
                
                {{/if}}


              <div class="checkout-address-box ">
                 Enter company name or your name
                <div class="form-group row">
                    <div class="col-md-6">
                      <label for="c_diff_fname" class="text-black">First Name <span class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="c_diff_fname" value="{{user.firstname}}" name="address[ship_first_name]" required>
                    </div>
                    <div class="col-md-6">
                      <label for="c_diff_lname" class="text-black">Last Name </label>
                      <input type="text" class="form-control" id="c_diff_lname" value="{{user.lastname}}" name="address[ship_last_name]" >
                    </div>
                  </div>

      

                  <div class="form-group row">
                    <div class="col-md-12">
                      <label for="c_diff_address" class="text-black">Address  <span class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="c_diff_address"  name="address[ship_address]" value="{{json user.address 'ship_address'}}" placeholder="Street address" required>
                    </div>
                  </div>

                  <div class="form-group">
                    <input type="text" class="form-control"  name="address[ship_address_more]" value="{{json user.address 'ship_address_more'}}"  placeholder="Apartment, suite, unit etc. (optional)">
                  </div>

                  <div class="form-group row">
                    <div class="col-md-6">
                      <label for="c_diff_state_country" class="text-black">State <span class="text-danger">*</span></label>
                      <select type="text" class="form-control stateDataList" value="{{json user.address 'ship_state_country'}}"   id="c_diff_state_country"  name="address[ship_state_country]"  required >
                        <option value="" selected="" disabled="">Select State {{json user.address 'ship_state_country'}}</option>
                     </select>                        
                    
                    </div>
                    <div class="col-md-6">
                      <label for="c_diff_postal_zip" class="text-black">Postcode / Zip <span class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="c_diff_postal_zip" value="{{json user.address 'ship_zip'}}" name="address[ship_zip]" required>
                    </div>
                  </div>

                  <div class="form-group row mb-5">
                    <div class="col-md-6">
                      <label for="c_diff_email_address" class="text-black">Email Address <span class="text-danger">*</span></label>
                      <input type="text" class="form-control signup-email-checkout" autocomplete="off" id="c_diff_email_address" value="{{user.email}}" name="address[ship_email]" required>
                      <div class="small email-status-checkout"></div>
                    </div>
                    <div class="col-md-6">
                      <label for="c_diff_phone" class="text-black">Mobile Number <span class="text-danger">*</span></label>
                      <input type="text"  class="form-control mobile-otp-checkout" onkeyup="sendOtpBtnCheckout(this)" id="c_diff_phone" value="{{user.phone}}" pattern="[1-9]{1}[0-9]{9}" title="Enter 10 Digit valid mobile number" name="address[ship_phone]" placeholder="Mobile Number" required>
                       <div class="small phone-status-checkout"></div>
                     <div class="otp-main-section text-center"> 
                     <div class="input-group">
                        
                        <input type="button" onclick="sendOtpCheckout()" class="btn btn-primary btn-lg btn-block btn-otp-checkout hide" value="SEND OTP">
                     </div>

                    <div class="verify-otp-section hide"> 

                     <div class="input-group">
                        <span class="input-group-addon"><i class="icon icon-key"></i></span>
                        <input type="password" class="form-control otp-checkout"  placeholder="ENTER OTP" >
                     </div>
                       
                        
                     <div class="input-group">
                        
                        <button type="button" onclick="sendOtpVerifyCheckout(this)" class="btn btn-primary btn-lg btn-block btn-otp">Verify OTP</button>
                     </div>
                  </div>
               </div>
                    </div>
                   
                  </div>
                 
                  
             

              {{#if app.session.user._id }}
              <div class="form-group">
                <label for="c_create_account" class="text-black" data-toggle="collapse" href="#create_an_account" role="button" aria-expanded="false" aria-controls="create_an_account">
                  <input type="checkbox" value="1" id="c_create_account" name="is_create_account"> Create an account?</label>
                <div class="collapse" id="create_an_account">
                  <div class="py-2">
                    <p class="mb-3">Create an account by entering the information below. If you are a returning customer please login at the top of the page.</p>
                    <div class="form-group">
                      <label for="c_account_password" class="text-black">Account Password</label>
                      <input type="password" class="form-control" id="c_account_password" name="checkout_password" placeholder="">
                    </div>
                  </div>
                </div>
              </div>
              {{/if}}

              <div class="form-group">
                <label for="c_ship_different_address" class="text-black" data-toggle="collapse" href="#ship_different_address" role="button" aria-expanded="false" aria-controls="ship_different_address">
                  <input type="checkbox" value="1" name="is_bill_address" id="c_ship_different_address"> Is your billing address different?</label>
                <div class="collapse" id="ship_different_address">
                  <div class="py-2">
                      <div class="form-group row">
                          <div class="col-md-6">
                            <label for="c_fname" class="text-black">First Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="c_fname" name="address[bill_first_name]" value="{{user.addresses.0.c_fname}}">
                          </div>
                          <div class="col-md-6">
                            <label for="c_lname" class="text-black">Last Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="c_lname" name="address[bill_last_name]">
                          </div>
                        </div>
          
                        <div class="form-group row">
                          <div class="col-md-12">
                            <label for="c_address" class="text-black">Address <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="c_address" name="address[bill_address]" placeholder="Street address">
                          </div>
                        </div>
          
                        <div class="form-group">
                          <input type="text" class="form-control" name="address[bill_address_more]" placeholder="Apartment, suite, unit etc. (optional)">
                        </div>
          
                        <div class="form-group row">
                          <div class="col-md-6">
                            <label for="c_state_country" class="text-black">State  <span class="text-danger">*</span></label>
                            <select type="text" class="form-control stateDataList" id="c_state_country" name="address[bill_state_country]">
                              <option value="" selected="" disabled="">Select State</option>
                            </select>
                          </div>
                          <div class="col-md-6">
                            <label for="c_postal_zip" class="text-black">Postcode / Zip <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="c_postal_zip" name="address[bill_zip]">
                          </div>
                        </div>
          
                        <div class="form-group row mb-5">
                          <div class="col-md-6">
                            <label for="c_email_address" class="text-black">Email Address <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="c_email_address" name="address[bill_email]">
                           
                          </div>
                          <div class="col-md-6">
                            <label for="c_phone" class="text-black">Mobile Number <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="c_phone" name="address[bill_phone]" placeholder="Mobile Number">
                          </div>
                        </div>
                    


                  </div>

                </div>
              </div>

            </div>

              <div class="form-group">
                <label for="c_order_notes" class="text-black">Order Notes</label>
                <textarea name="order[orderNote]" id="c_order_notes" cols="30" rows="5" class="form-control" placeholder="Write your notes here..."></textarea>
              </div>

            </div>
          </div>

          <div class="col-md-6">

{{#if app.session.coupon.coupon_code }}
            <div class="row mb-5 hide">
              <div class="col-md-12">
                <h2 class="h3 mb-3 text-black">Coupon Code</h2>
                <div class="p-3 p-lg-5 border">
                  
                  <label for="coupon" class="text-black mb-3">Enter your coupon code if you have one</label>
                  <div class="input-group w-75">
                    <input type="text" class="form-control" id="coupon" value="" placeholder="Coupon Code" aria-label="Coupon Code" aria-describedby="button-addon2">
        
                    <div class="input-group-append">
                      <button class="btn btn-primary btn-sm"  onclick="checkCouponCode()" type="button" id="button-addon2">Apply</button>
                    </div>
                 
                  </div>
                  <span class="coupon-status"> </span>
                </div>
              </div>
            </div>
{{/if}}

 <h2 class="h3 mb-3 text-black">User Payment detail </h2>
   <div class="form-group row">
                   
                    <div class="col-md-6">
                      <label for="c_diff_gname" class="text-black">GST Number </label>
                      <input type="search" class="form-control" id="c_diff_gname" value="{{user.gstNumber}}" name="user[gstNumber]" placeholder="" autocomplete="off" >
                    </div>
                    <div class="col-md-6">
                      <label for="c_diff_pname" class="text-black">PAN Number</label>
                      <input type="text" class="form-control" id="c_diff_pname" value="{{user.panNumber}}" name="user[panNumber]" placeholder="Ex. AQRE1233">
                    </div>
                  </div>

            
            <div class="row mb-5">
              <div class="col-md-12">
                <h2 class="h3 mb-3 text-black">Your Order</h2>
                <div class="p-3 p-lg-5 border">
                  <table class="table site-block-order-table mb-5">
                    <thead>
                      <th>Product</th>
                      <th>Total</th>
                    </thead>
                    <tbody>
                      {{ set 'subtotal' 0 }}
                      
                      
                   

                      {{#each session.cart }}

                      {{add 'subtotal' (math price qty '*') }}
                      <tr>
                        <td class="small">
                         
                          {{category}}
                          
                          {{name}}
                         <strong class="mx-2">x</strong> {{qty}} Qty 
                         <br>
                          
                        </td>
                        <td class="text-right">
                        

                          <i class="icon-inr"></i>{{math price qty '*'}}</td>
                      </tr>
                     
                      {{/each}}

                    {{ set 'discount'  0 }}
                     {{ set 'total' (math subtotal discount '+')}}


                      <tr>
                        <td class="text-black font-weight-bold"><strong>Cart Subtotal</strong></td>
                        <td class="text-black text-right"><i class="icon-inr"></i>{{math subtotal}}</td>
                      </tr>
                     

                      {{#if user.coupon.coupon_code }}
                      <tr class="coupon-diplay-container hide">
                          <td class="text-black font-weight-bold"><strong class="cart-page-discount-label"></strong> <span class="btn btn-xs-r btn-outline-info" onclick="removeCoupon()">&times;</span></td>
                          <td class="text-black"><strong class="text-black checkout-page-discount-display">0.00</strong></td>
                        </tr>
                        
                      {{/if}}
                     
                       
                        <tr class="tax-row">
                        <td class="text-black font-weight-bold"><strong>GST Total</strong></td>
                        <td class="text-black text-right"> <strong class="text-black checkout-gst-total">0</strong></td>
                      </tr>
                      <tr>
                        <td class="text-black font-weight-bold tsc-label"><strong>Tcs of Any Goods</strong></td>
                        <td class="text-black cart-extra-tax text-right">0</td>
                      </tr>
                      <tr>
                        <td class="text-black font-weight-bold"><strong>Order Total</strong></td>
                        <td class="text-black font-weight-bold text-right"><strong class="checkout-page-total-display"> <i class="icon-inr"></i>{{math total}}</strong></td>
                        <input type="hidden" class="checkout-page-subtotal" value="{{subtotal}}" name="order[subTotal]">
                        <input type="hidden" class="checkout-page-discount" value="{{discount}}" name="order[discount]">
                         <input type="hidden" class="checkout-page-gst"  name="order[tax]">
                         <input type="hidden" class="checkout-page-extra-tax"  name="order[extraTax]">
                        <input type="hidden" class="checkout-page-total" value="{{total}}" name="order[total]">
                       
                      </tr>
                    </tbody>
                  </table>

                  <div class="border p-3 mb-3">
                    <h6>Payment Method</h6>

                    <label><input type="radio"   name="order[paymentMethod]" onclick="$('.gateway-detail').fadeIn(500);$('.bank-transfer').fadeOut(500);" value="Razorpay" required=""> Pay with Razorpay </label> &nbsp; &nbsp;


                    <label><input type="radio" onclick="$('.gateway-detail').fadeOut(500);$('.bank-transfer').fadeIn(500)" name="order[paymentMethod]" value="BankTransfer" required=""> Payment Via NEFT / RTGS </label> &nbsp; &nbsp;

                    {{#if (eq session.user.credit 1)}}
                    <label><input type="radio" onclick="$('.gateway-detail').fadeOut(500); $('.bank-transfer').fadeOut(500);" name="order[paymentMethod]" value="Credit" required="" > Credit Amount </label>
                    {{/if}}


                  </div>


                  <div class="border p-3 mb-3 bank-transfer hide">
                    <h3 class="h6 mb-0"><a class="d-block" data-toggle="collapse" href="#bank-transfer" role="button" aria-expanded="false" aria-controls="bank-transfer"> Pay using Bank Transfer You need to upload payment reciept</a>
                      <li>
                        Bank Name : ICICI BANK
                      </li>
                      <li>
                        A/c No. : 695605500313
                      </li>
                      <li>
                        Branch & IFS Code : SHAHIBABAD & ICIC0006956
                      </li>
                    </h3>

                    <div class="collapse" id="bank-transfer">
                      <div class="py-2">
                        <p class="mb-0">
                          
                             Reciept or Copy Image of transfer amount with name etc
                        </p>
                      </div>
                    </div>
                  </div>


                  <div class="border p-3 mb-3 gateway-detail hide">
                    <h3 class="h6 mb-0"><a class="d-block" data-toggle="collapse" href="#collapsebank" role="button" aria-expanded="false" aria-controls="collapsebank"> Pay using Credit Card/Debit Card/NetBanking and UPI etc with Razorpay.</a></h3>

                    <div class="collapse" id="collapsebank">
                      <div class="py-2">
                        <p class="mb-0">
                          
                             Credit Card/Debit Card/NetBanking
                            Pay securely by Credit or Debit card or Internet Banking through Razorpay.
                        </p>
                      </div>
                    </div>
                  </div>

            

                  Your personal data will be used to process your order, support your experience throughout this website, and for other purposes described in our <a href="{{app.url}}privacy-policy">privacy policy</a>.
				          <br>
                 <label><input type="checkbox" required/> I have read and agree to the website <a href="{{app.url}}terms-conditions">terms and conditions</a> *</label>
                  <br>

                  
                     <div class="form-group">
                      <button type="submit" class="btn btn-primary btn-lg py-3 btn-block submit-checkout" >
                      	Place Order
                      </button>
                      
                    </div>
                 
                </div>
              </div>
            </div>

          </div>
        </div>
        </form>
      </div>
    </div>


 <script type="text/javascript">




  var otp_checkout = 0;
  var phone = 0;
/*
 function sendOtpBtnCheckout(t){
         var val = $(t).val();
         if(val.length==10)
            $('.btn-otp-checkout').removeClass('hide');

    }*/


                    
     
               
  function checkForSubmit(th){
    app.showToast("Please verify mobile number first to shipping address");
    return false;
}      



 phone = $('.mobile-otp-checkout').val();

function sendOtpBtnCheckout(){
  $('.phone-status-checkout').html("");
  var val = $('.mobile-otp-checkout').val();
  if(val.length==10){
    
      var url = base_url+"api/check-phone";
      var data = {'phone':val};
      $('.phone-status-checkout').html('<i class="text-info">Please wait a while checking mobile number</i>');
      app.post(url,data,function(res){
         
            if(!res.err){
             
              $('.phone-status-checkout').html('<i class="text-success">You have changed mobile.</i>');
               $('.submit-checkout').attr('type','submit').removeAttr('onclick');
            }else {

              if(val==phone ){
                 $('.submit-checkout').attr('type','submit').removeAttr('onclick');
                $('.phone-status-checkout').html('');
              }
              else
                $('.phone-status-checkout').html('<i class="text-danger">This Mobile already used</i>');
          }
      });

 }else{
  
   $('.phone-status-checkout').html('<i class="text-danger">Enter 10 digit mobile number</i>');
 }
  
}







$(()=>{
  $('.mobile-otp-checkout').on('keypress',function(event){
     $('.submit-checkout').attr('type','button').attr('onclick','checkForSubmit(this)');
    $('.phone-status-checkout').html('');
      var keycode = event.which;
         if(keycode < 48 || keycode > 57){
        return false;
      }

       
  });



  $('.signup-email-checkout').on('change',function(){
    var email = $(this).val();
    var th = this;
    if(validedEmail(email)){
      $('.email-status-checkout').html('<i class="text-info">Please wait while checking email Availablilty.</i>');
      var url = base_url+"api/check-email";
          var data = {'email':email};
          
          app.post(url,data,function(res){
            if(!res.err){
              $('.email-status-checkout').html('<i class="text-success">This email available.</i>');
            }else{
              $('.email-status-checkout').html('<span class="text-danger">\
               '+email+' already used for this site. ');
              $(th).val('');
            }
          });
      }else{
        $('.email-status-checkout').html('<i class="text-danger">You have entered an invalid email address!</i>'); 
      }

  });

  $('.signup-email').on('keypress',function(){
      $('.email-status-checkout').html('');
  });
});


app.get('{{app.url}}json/states.json',res=>{
  var value = "{{json user.address 'ship_state_country'}}";
  for(key in res){
    if(value == res[key])
      $('.stateDataList').append('<option value="'+res[key]+'" selected>'+res[key]+'</option>');
    else
      $('.stateDataList').append('<option value="'+res[key]+'" >'+res[key]+'</option>');
  }
  var state = jQuery('#c_diff_state_country').val();
 
  if(state.length){
    setTax(state);
  }
})
  

var gstTotal = 0; 

jQuery('#c_diff_state_country').change(function(){
  var state = jQuery(this).val();
  if(state.length){
    setTax(state);
  }
});


jQuery(()=>{
  var state = jQuery('#c_diff_state_country').val();
  if(state.length){
    setTax(state);
  }
})


function setTax(state){
  if(!gstTotal)
     gstTotal = parseFloat(jQuery('.checkout-gst-total').text());

   
   let sgstTotal = gstTotal/2;
   let cgstTotal = gstTotal/2;
   
  if(state == 'Uttar Pradesh'){
      $('.tax-row').replaceWith(
        '<tr class="tax-row">\
                        <td class="text-black font-weight-bold"><strong>CGST</strong></td>\
                        <td class="text-black text-right"> <strong class="text-black checkout-gst-total"><i class="icon-inr"></i>'+(cgstTotal.toFixed(3))+'</strong></td>\
                      </tr>'
                      +
                      '<tr class="tax-row">\
                        <td class="text-black font-weight-bold"><strong>SGST</strong></td>\
                        <td class="text-black text-right"> <strong class="text-black checkout-gst-total"><i class="icon-inr"></i>'+(sgstTotal.toFixed(3))+'</strong></td>\
                      </tr>'
        );
  }else{
    $('.tax-row').eq(0).replaceWith(
        '<tr class="tax-row">\
                        <td class="text-black font-weight-bold"><strong>IGST</strong></td>\
                        <td class="text-black text-right"> <strong class="text-black checkout-gst-total"><i class="icon-inr"></i>'+(gstTotal.toFixed(3))+'</strong></td>\
                      </tr>'
                      
        );
    $('.tax-row').eq(1).remove();
  }
}

</script>

{{include 'global/footer'}}
